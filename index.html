<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego Troll Fácil</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  font-family: Arial,sans-serif;
  height: 100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background: linear-gradient(270deg,#ff0000,#00ff00,#0000ff);
  background-size: 600% 600%;
  animation: gradientBG 15s ease infinite;
  color:white;
}
@keyframes gradientBG {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}
#gameContainer { text-align:center; z-index:10; position:relative; }
#equation { font-size:2em; margin-bottom:10px; text-shadow:0 0 5px black; }
#timer { font-size:1.5em; margin-bottom:20px; transition: color 0.2s; }
#result { font-size:1.5em; text-shadow:0 0 5px black; }
input { font-size:1.5em; padding:10px; width:100px; text-align:center; }
.cat {
  position:absolute;
  width:100px;
  animation: spin 10s linear infinite;
  transition: all 0.5s ease;
}
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
@keyframes blink {0%,50%,100%{opacity:1;}25%,75%{opacity:0;}}
.warning { animation:blink 0.5s infinite; color:red !important; }
</style>
</head>
<body>

<div id="gameContainer">
  <div id="equation">0 + 0 = ?</div>
  <div id="timer">20</div>
  <input type="number" id="answer" autocomplete="off">
  <div id="result"></div>
</div>

<!-- Sonidos y música -->
<audio id="music" src="musica_troll.mp3" loop autoplay></audio>
<audio id="soundCorrect" src="correcto.mp3"></audio>
<audio id="soundIncorrect" src="incorrecto.mp3"></audio>
<audio id="soundPerdiste" src="perdiste.mp3"></audio>

<!-- Gatos -->
<img src="gato1.png" class="cat" style="top:10%; left:10%;">
<img src="gato2.png" class="cat" style="top:10%; left:70%;">
<img src="gato3.png" class="cat" style="top:60%; left:20%;">
<img src="gato4.png" class="cat" style="top:60%; left:70%;">
<img src="gato5.png" class="cat" style="top:30%; left:40%;">
<img src="gato6.png" class="cat" style="top:40%; left:60%;">

<script>
let answerInput = document.getElementById('answer');
let equationDiv = document.getElementById('equation');
let resultDiv = document.getElementById('result');
let timerDiv = document.getElementById('timer');

let correctAnswer = 0, failCount = 0, timeLeft = 20, correctStreak = 0, timerInterval;

const music = document.getElementById('music');
const soundCorrect = document.getElementById('soundCorrect');
const soundIncorrect = document.getElementById('soundIncorrect');
const soundPerdiste = document.getElementById('soundPerdiste');
const cats = document.querySelectorAll('.cat');

soundCorrect.volume = 0.3;
soundIncorrect.volume = 1.0;
soundPerdiste.volume = 1.0;

document.addEventListener('click',()=>music.play(),{once:true});

function generateEquation(){
  let a = Math.floor(Math.random()*10)+1;
  let b = Math.floor(Math.random()*10)+1;
  let op = ['+','-'][Math.floor(Math.random()*2)]; // Solo + y -
  correctAnswer = (op === '+') ? a+b : a-b;
  equationDiv.textContent=`${a} ${op} ${b} = ?`;

  answerInput.value='';
  answerInput.focus();

  clearInterval(timerInterval);
  timeLeft = 20;
  timerDiv.textContent = timeLeft;
  timerDiv.classList.remove('warning');

  timerInterval = setInterval(()=>{
    timeLeft--;
    timerDiv.textContent=timeLeft;
    if(timeLeft<=5) timerDiv.classList.add('warning');
    if(timeLeft<=0){
      clearInterval(timerInterval);
      soundPerdiste.currentTime=0;
      soundPerdiste.play();
      music.playbackRate += 0.2;
      setTimeout(()=>{
        if(window.close) window.close();
        else window.location.href='about:blank';
      },1000);
    }
  },1000);
}

function moveCats(){
  cats.forEach(cat=>{
    cat.style.top=Math.random()*80+'%';
    cat.style.left=Math.random()*80+'%';
    cat.style.transform=`rotate(${Math.random()*360}deg) scale(${1+Math.random()*0.5})`;
  });
}

function handleFail(){
  failCount++;
  soundIncorrect.currentTime=0;
  soundIncorrect.play();
  music.playbackRate += 0.1;

  if(failCount>=3){
    soundPerdiste.play();
    music.playbackRate += 0.2;
    setTimeout(()=>{ window.location.href='perdedor.html'; },1000);
  } else{
    resultDiv.textContent='¡Fallaste! Más difícil...';
    generateEquation();
  }
}

function handleWin(){
  soundCorrect.currentTime=0;
  soundCorrect.play();
  music.playbackRate += 0.2;
  // Reproducir correcto 6 segundos
  setTimeout(()=>{ soundCorrect.pause(); window.location.href='ganador.html'; },6000);
}

answerInput.addEventListener('keydown',function(e){
  if(e.key==='Enter'){
    music.play();
    if(parseInt(answerInput.value)===correctAnswer){
      resultDiv.textContent='¡Correcto!';
      failCount=0;
      correctStreak++;
      moveCats();
      // Reproducir sonido correcto 6 segundos
      soundCorrect.currentTime=0;
      soundCorrect.play();
      setTimeout(()=>{ soundCorrect.pause(); },6000);

      if(correctStreak>=5) handleWin();
      else generateEquation();
    } else handleFail();
  }
});

setInterval(generateEquation,20000);
setInterval(moveCats,1500);
generateEquation();
moveCats();
</script>
</body>
</html>
